---
import { joinURL, withTrailingSlash } from "ufo";
import { Octokit, type RestEndpointMethodTypes } from "@octokit/rest";

import { Image } from "astro:assets";

import DefineLocalDate from "../components/DefineLocalDate.astro";

import { GITHUB_OWNER, GITHUB_REPO, PRODUCTION_BASE_URL } from "../lib/info.js";

import Layout from "../layouts/Layout.astro";

import demo from "../assets/demo.gif";
import icon from "../assets/obs-backgroundremoval-icon.jpg";

export type LatestRelease =
  RestEndpointMethodTypes["repos"]["getLatestRelease"]["response"]["data"];

const { BASE_URL } = import.meta.env;

async function getLatestRelease(): Promise<LatestRelease> {
  const octokit = new Octokit({ auth: import.meta.env.GITHUB_TOKEN });

  const latestRelease = await octokit.rest.repos.getLatestRelease({
    owner: GITHUB_OWNER,
    repo: GITHUB_REPO,
  });

  return latestRelease.data;
}

const release = await getLatestRelease();
---

<Layout lang="en" title="OBS Background Removal">
  <Fragment slot="head-info">
    <meta
      name="description"
      content="OBS Plugin: Background Removal / Virtual Green-screen and Low-Light Enhancement"
    />
    <link rel="canonical" href={withTrailingSlash(PRODUCTION_BASE_URL)} />
  </Fragment>

  <Fragment slot="head-bottom">
    <DefineLocalDate />
  </Fragment>

  <main class="white-box">
    <header class="icon-and-name">
      <Image src={icon} alt="OBS Background Removal Icon" height="50" />
      <h1>OBS Background Removal</h1>
    </header>

    <p>
      OBS Plugin: Background Removal / Virtual Green-screen and Low-Light
      Enhancement
    </p>

    <p style="text-align: center;">
      <Image
        src={demo}
        alt="Demo of OBS Background Removal Plugin"
        width="600"
      />
    </p>

    <h2>
      Download Latest {release.tag_name}
      {
        [
          "(",
          <local-date data-date={release.published_at}>
            <time datetime={release.published_at}>{release.published_at}</time>
          </local-date>,
          ")",
        ]
      }
    </h2>

    <ul class="download-links">
      <li><a href={joinURL(BASE_URL, "windows/")}>Windows</a></li>
      <li><a href={joinURL(BASE_URL, "macos/")}>macOS</a></li>
      <li><a href={joinURL(BASE_URL, "ubuntu/")}>Ubuntu</a></li>
      <li><a href={joinURL(BASE_URL, "flatpak/")}>Flatpak</a></li>
      <li><a href={joinURL(BASE_URL, "arch/")}>Arch Linux</a></li>
    </ul>

    <div style="text-align: center;">
      <a
        href={joinURL(BASE_URL, "interactive-help/")}
        class="ask-anything-button"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="32"
          height="32"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          style="vertical-align: middle; margin-right: 0.5em;"
          ><path
            d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
          ></path></svg
        >
        <span style="vertical-align: middle; font-weight: bold;"
          >Ask Anything (Experimental)</span
        >
      </a>
    </div>

    <p>
      See our <a href={joinURL(BASE_URL, "usage/")}>Usage</a> page for instructions
      on usage in OBS
    </p>

    <p>
      <a href={joinURL(BASE_URL, "versions/")}>Version History</a>
    </p>

    <p>
      <a href={joinURL(BASE_URL, "dev/")}>Developer resources</a>
    </p>

    <p>
      <a href={joinURL(BASE_URL, "uninstall/")}>Uninstall instructions</a>
    </p>

    <p>
      <a
        href="https://github.com/royshil/obs-backgroundremoval"
        target="_blank"
        rel="noopener"
      >
        View on GitHub
      </a>
    </p>
  </main>
</Layout>

<style>
  header.icon-and-name {
    display: flex;
    align-items: center;
  }

  header.icon-and-name h1 {
    margin-left: 10px;
  }

  .ask-anything-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 1em 2em;
    font-size: 1.2em;
    border-radius: 999px;
    background: var(--color-button-2, #4f8cff);
    color: #fff;
    text-decoration: none;
    box-shadow: 0 4px 16px var(--color-box-shadow, rgba(0, 0, 0, 0.1));
    margin: 1em auto;
    transition:
      background-color 0.2s,
      box-shadow 0.2s;
    font-weight: bold;
  }
  .ask-anything-button:hover,
  .ask-anything-button:focus {
    background: var(--color-button-1, #2563eb);
    box-shadow: 0 6px 24px var(--color-box-shadow, rgba(0, 0, 0, 0.15));
  }
</style>
